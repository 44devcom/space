---
alwaysApply: true
---
# Docker Puppeteer UI Testing Service

## Purpose

Define a **Dockerized Puppeteer** test runner for Chrome-only UI/E2E tests.

Service name: `ui-tests-puppeteer`.

---

## Inputs

- `serviceName` (default: `ui-tests-puppeteer`)
- `baseUrl` (default: `http://api:80`)
- `testDir` (default: `tests/ui`)
- `reportsDir` (default: `reports/ui`)
- `nodeVersion` (default: `18`)

---

## Generated Files

- `docker/ui/puppeteer/Dockerfile`
- docker-compose service snippet
- `tests/ui/puppeteer-example.spec.ts` or `.js`
- `scripts/run-ui-tests-puppeteer.sh`

---

## Dockerfile Template (Puppeteer)

```Dockerfile
# docker/ui/puppeteer/Dockerfile

FROM node:18-bullseye

# Install Chromium + fonts
RUN apt-get update && \
    apt-get install -y ca-certificates fonts-liberation libasound2 libatk1.0-0 \
      libc6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 \
      libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 \
      libnss3 libglib2.0-0 libdbus-1-3 libdrm2 libgbm1 libgtk-3-0 wget \
      --no-install-recommends && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY package*.json ./
RUN npm install --omit=dev --silent || npm install --silent

COPY tests/ui ./tests/ui

ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
ENV BASE_URL=${BASE_URL:-http://api:80}
ENV CI=1

CMD ["npm", "test"]
```

(Your agent can adapt CMD based on your actual test runner: npx jest, node, etc.)

## docker-compose Service Snippet (Puppeteer)

```yaml
services:
  ui-tests-puppeteer:
    build:
      context: .
      dockerfile: docker/ui/puppeteer/Dockerfile
    container_name: ui-tests-puppeteer
    environment:
      BASE_URL: ${UI_TEST_BASE_URL:-http://api:80}
      PUPPETEER_HEADLESS: "1"
    depends_on:
      api:
        condition: service_healthy
    networks:
      - default
    volumes:
      - ./tests/ui:/app/tests/ui:ro
      - ./reports/ui:/app/reports/ui
    command: >
      sh -c "npm test"
```

## Test Runner Script

```bash
# scripts/run-ui-tests-puppeteer.sh
#!/usr/bin/env bash
set -euo pipefail

docker compose run --rm ui-tests-puppeteer "$@"
```

## Agent Instructions

For ui-docker with uiTestingTool = puppeteer:

- Generate Dockerfile above.
- Extend docker-compose.
- Create scripts/run-ui-tests-puppeteer.sh.

For ui-tests:

- Generate minimal Puppeteer test skeleton using puppeteer.launch({ headless: true }).
- Use process.env.BASE_URL as test base URL.
